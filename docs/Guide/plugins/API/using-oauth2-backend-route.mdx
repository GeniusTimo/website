---
title: Using the built in OAUTH2 route (backend)
sidebar_position: 4
---

:::warning

If you are using localhost as your test environment, make sure you use http://127.0.0.1 instead of http://localhost in
your browser otherwise you may encounter problems with the cookie setting successfully.

:::

If you want your bot to have a web dashboard, you need to implement OAUTH2 authentication. This is a way for users to
log in to your bot's website using their Discord account.

In order to implement this using Sapphire's built-in OAUTH2 feature, you will need to define OAUTH2 information within
the `api` options in the [`ClientOptions`]:

```typescript ts2esm2cjs|{6-11}|{6-11}
import { SapphireClient } from '@sapphire/framework';
import { OAuth2Scopes } from 'discord.js';

const client = new SapphireClient({
  api: {
    auth: {
      id: 'BOT_CLIENT_ID',
      secret: 'BOT_CLIENT_SECRET',
      scopes: [OAuth2Scopes.Identify, OAuth2Scopes.Guilds],
      cookie: 'SAPPHIRE_AUTH'
    }
  }
});
```

:::info

In the code block above we specify the OAUTH2 scopes that we want. The default of the plugin is only
[`OAuth2Scopes.Identify`][oauth2-identify], which means that no guild data will be fetched. Because we are creating a
settings web dashboard we do want guild data, therefore we add the [`Guilds`][oauth2-guilds] OAUTH2 scope. For more
information on OAUTH2 scopes see [the discord developer documentation][discord-dev-oauth2scopes]

:::

Once you have done this, we can leverage the built-in `/oauth/callback` route to handle the OAUTH2 callback and retrieve
the [`LoginData`] from the Discord API. The specific data we get back depends on the scopes defined in our
[`ClientOptions`] - in our case, we used the `identify` and the `guilds` scope, so we'll get both [`LoginData.user`] and
[`LoginData.guilds`].

## Next steps

Now that you have implemented OAUTH2 authentication, you will need to create a front-end to send the `code` query
parameter to [`http://your_domain/oauth/callback`](http://your_domain/oauth/callback) to save the cookie to your browser
and obtain your [`AuthData`].

The `code` query parameter is obtained from the Discord OAUTH2 URL provided by your application. When obtaining this
URL, make sure to add a redirect URI for [`http://your_domain/oauth/callback`](http://your_domain/oauth/callback).

Here is an example POST request to swap the `code` for [`AuthData`] with your API.

```typescript
const response = await fetch('http://your_domain/oauth/callback', {
  method: 'POST',
  body: JSON.stringify({
    code: 'CODE_FROM_DISCORD'
  })
});

const authData = await response.json();

console.log(authData);
```

[discord-dev-oauth2scopes]: https://discord.com/developers/docs/topics/oauth2#shared-resources-oauth2-scopes
[oauth2-identify]: https://discord-api-types.dev/api/discord-api-types-v10/enum/OAuth2Scopes#Identify
[oauth2-guilds]: https://discord-api-types.dev/api/discord-api-types-v10/enum/OAuth2Scopes#Guilds
[`ClientOptions`]: ../../../Documentation/api-framework/interfaces/SapphireClientOptions
[`auth`]: ../../../Documentation/api-plugins/classes/api_src.ApiRequest#auth
[`AuthData`]: ../../../Documentation/api-plugins/interfaces/api_src.AuthData
[`LoginData`]: ../../../Documentation/api-plugins/interfaces/api_src.LoginData
[`LoginData.user`]: ../../../Documentation/api-plugins/interfaces/api_src.LoginData#user
[`LoginData.guilds`]: ../../../Documentation/api-plugins/interfaces/api_src.LoginData#guilds
